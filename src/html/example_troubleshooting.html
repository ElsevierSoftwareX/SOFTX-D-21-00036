<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2020b"><title>Troubleshooting the HEV with a Three-Way Catalyst example</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 28.8px; min-height: 0px; white-space: pre-wrap; color: rgb(213, 80, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 24px; font-weight: 400; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F7F7F7; margin: 10px 0 10px 0;}
.S3 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 4px; padding: 6px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S4 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(0, 0, 0); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S5 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S6 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.S7 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.S8 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 1px solid rgb(233, 233, 233); border-bottom: 0px none rgb(0, 0, 0); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S9 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 1px solid rgb(233, 233, 233); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { border-left: 1px solid rgb(233, 233, 233); border-right: 1px solid rgb(233, 233, 233); border-top: 0px none rgb(0, 0, 0); border-bottom: 0px none rgb(0, 0, 0); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 17.234px; min-height: 18px; white-space: nowrap; color: rgb(0, 0, 0); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S11 { margin: 20px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(60, 60, 60); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }</style></head><body><div class = rtcContent><h1  class = 'S0'><span>Troubleshooting the HEV with a Three-Way Catalyst example</span></h1><div  class = 'S1'><span>Consider the </span><a href = "./example_split_hev.html"><span>HEV with a Three-Way Catalyst</span></a><span>. The system and cost functions that are used there are designed with some extra-care so as to avoid all the common issues that may arise with DynaProg. These issues are tipically related to the way in which MATLAB handles n-dimensional arrays; for more information, see </span><a href = "./troubleshooting.html"><span>Troubleshooting your model and Safe Mode</span></a><span>.</span></div><div  class = 'S1'><span>We will start from a naively designed model function, analyze some issues that prevent their usage without using Safe Mode and discuss some solutions.</span></div><h2  class = 'S2'><span>Troubleshooting the system and cost functions</span></h2><div  class = 'S1'><span>Open the naive version of the external model by entering</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>open(</span><span style="color: rgb(170, 4, 249);">'hev_ext_naive.m'</span><span>)</span></span></div></div></div><div  class = 'S4'><span>in the Command Window.</span></div><div  class = 'S1'><span>Since this optimization problem involves two stae variables and two control variable, which are discretized on computational grids having </span><span texencoding="N_{x_1}" style="vertical-align:-10px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAwCAYAAACFUvPfAAADY0lEQVRoQ+3YWch1YxgG4OuPDMlQOODEkNJPoYgDSqaUZJYpw4GSzHMZEpIpOeBXSsZMGUOZU0qiSHIiP5JwgvozpYjuelZtq7XW9+1tf3v3a6/afX2t533f+73f57mf+12rrIfPqvUQswXoWZ3agukF0wMM/O/SYxecWr9da+MP4Xz82kHEVjgZx+Dwev81HsQ9+HFa6bMcpg/Ew9gBn+MEfDIAYCc8gS1qE0OxE+1jOaC3xeM4tFa4DHfh754Vc0JP4l1ciT8mQvYfc3pvvITtap43cQa+75l3f7yCs/DctAFnvuUwfQ5Ow5c4s0AcPwDokoo7CZ/NA/SmlQq/4Xk8VYz3FeTmWFNAz8PP8wCd4ks+34sXSgVy7EmNqMQHLVBN/DO12ZXAvGR6HFbMNYpxHJ4tJDfhBvw1gizxUZquDU1tA0M5nXfXYE+cjXWVGo+UkryPU/BVoWniU4in44epoWxNNAR6S9xf2nxdMZr4FNqdHQXZFb8iuIdA74Hk5uV4cWT1pnnsh9GC7IufOvAh0JG5K9CWrg1wPcL+aEEehRs74mcGeiPcim3QJV37lpqk4aQgb66N5P8+bzI18H1Mb4/H8FYBarfszUbkLwV5YSlJZPG+qaHrmagPdNOK0/ne6Bk7Kn9pOntV5/xwXqCjENHmWNPYy64nqdDIX96/utJS14DoYrppxXFnFyEtvOtpy98tVZyjzWZFSO8C3UjXo1VkQwvvjqexGke3pLEZF5eYdzm5d0rno+kp3kOqe348zu7aoDesgroaS/nmrLMxbsc+S6RSE5c2H9d4JF5HvHqs7ljdcxR0dp0JT6xd/1TNI544hr7vybiweCl+H4iLB48vSaFegPfGYXc0djl+etK52+Oay0TSLp7mz46JgyfpeVUZtU6yZgl657qGfVR53T6VHasxHYvEHtB3wrMCnVqJJTgXX5Sef9diepO6T15bdmDuoONLtkY66d3F4qdViGtb4ONp4mHmAjpHfBC+rb+3lTTm0nsHfsHbaMvdXEEfgRTdy8iRf1PMxpvshovxWseniLmCnlR1FqAnZW7ccQumx2Vs0vgF05MyN864dOhcmvObS3MZB2xi80nt4Lp45APRA/VBPq7wXz5lVt5j3A0Mxi9AT5XOgckWTC+YHmDgH6F2vDEnMNvpAAAAAElFTkSuQmCC" width="22.5" height="24" alt="N_(x_1)" /></span><span>, </span><span texencoding="N_{x_2}" style="vertical-align:-10px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC0AAAAwCAYAAACFUvPfAAAD2UlEQVRoQ+3YCYi9UxgG8N8/siRLoZASKSFLEQlJSCG7bPkjJNnXZEm27CRLRNZsWUN2iZKlSCghJFtZk71sPXq/6frce+fO/3/vzB3NV9M0873fOc95zvs+73POPLPwmTcLMZsDPV27Nsf0HNN9GPjfpcea2K9+1qqF34Kj8FMXIpbDPtgV29f7j3EzrsY3w0qfQZjeCrdiNbyPPfFmHwCr4y4sU4voF7tA6xgE9Iq4E9vWDCfiCvzVY8bs0N14EafgtwVCtpA5vREewco1zjOYjy96jLs5HsdBeGDYgDPeIEwfjv3xIQ4sEHv0AXR8xe2Nd2cC9JKVCj/jQdxTjPcqyKVxTQE9Ej/MBOgUX/L5WjxUKpBtT2pEJV5tgWri76vFjgLzpOmxXTHXKMbuuL+QnIuz8UcHssRHabotaGgL6JfTeXc6NsCh+L5S47ZSklewLz4qNE18CvEAfD00lK2B+oFeFjeWNp9ZjCY+hXZZl4LsFj8S3P1Ar4/k5kl4uGP2pnlsis6C7BU/dOD9QEfmTkZbuhbBWQj7nQW5M87pEj9toBfDhVgB3aRrk1KTNJwU5Pm1kPzdy5sMDXwvplfBHXi2ALVb9lId8peCPKaUJLJ4/dDQ9RioF+imFafzPd3j2075S9PZsDrnazMFOgoRbY41jb3s9iQVGvnL+ydGLXUNiG5MN6047uxYpIV3e9ryd0EVZ2ezGQnp3UA30nV7FVm/idfFvVgbu7SksfkuLjHvsnMvlM5H01O821T3fGMqq2uDXrQK6jRM5pszz+K4GBtPkkpNXNp8XONOeArx6rG6U+qenaCz6gy4V63622oe8cQx9L2efBcWT8AvfeLiweNLUqhH46WpsNsZO4ifXtCx2981h4mkXTzN762A9Uo6t8QStQNX4q32QNMJeo06hr1eed25K5HYHOFytnyvpDNmLD3gYLwzE0ynVmIJjsAHBerzApJGFQMWwM/X/xJ/aglB7EKKdqLBTRfT8SXLIwCvwhZ4uwoxXmY3XNpKmSadYtbSNyZ2ZpSgkw5b47P6fVFJYw69l+BHPFfgw+yvrdzNXUs67WNt/R8l6B2QonsUZ+CTYjbeZB0chyf7XEU0TMeA/etUP0rQC6s6hyBpdRi+nIlCnOoCVqrcz3VaU5wTY4wj08nvNKpPS1H+c5M1bqCDJ/q8Ki7v0oD+YXvcQOeyM+Yq2tztZnbsQG9Wju+81s1U8jsG6yb8OU5Mx9regJfxVUfVpvHEi6Tx5Og3Nkwnf6/Djj0kJneIkb/vxgn0VOVw7ApxoAWMm3rMgR6IgekKmpXp8TfS2coxQMHLuAAAAABJRU5ErkJggg==" width="22.5" height="24" alt="N_(x_2)" /></span><span>, </span><span texencoding="N_{u_1}" style="vertical-align:-10px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAwCAYAAABuZUjcAAADh0lEQVRoQ+2ZWehNURTGf//IkPEBhYyRUOZIRBnyZpZ5eCBCZM6UkEhJypDMZMoYD2R4MWXIiwclRR6khJKQB0NfrV3H6Zzz3/e4956uzq77cO9Ze59vf2etb3373CoqdFRVKG5y4OV+cjnjOeOeDPyXqdIBmGKfTkbEUWAh8DWCmMbAJGA0MMKuvwGOALuBj55keoX5MD4YOAa0AV4C44FnCau3A04DDW0jSbFeIKOCfIA3BU4Bw2yBZcBO4HfMXfWkzgD3gZXAj9ToEib6AO8NXAWa2zq3gBnAu5h1BwDXgFnAxVKA1po+wOcCU4FXwEwDMi4B1BKLmwi8yAp4XUuLb8Al4KwxH1ekDYA9BnYB8CUr4CpI5fde4LKpg1JAaSL1eBwC5uLP24ZLhbvaVBluDDolGQtcMDSbgY3AzwA6xUuBojZV1E0k5biurQW6A7OBz5Ymx01hHgGTgdeGyMWrOKcDH4qKNLRYEvBGwEHT7vXGrOJVfDsiijQqvmTYk4B3A5Sry4ErAQSuwfQDgkUaF18S8EnAJYErgLCs1QA2AHoKwSIdCWyKiC8r8FrANqAJECVrfU1l1JRUpFtsM/oe52WKuoE4xlsAJ4HbBirc3usFpFFFusgURpK5v6gIYxaLA+7atjrkzZi5QWlUY+phHfZplsClHNJu2VpZ06ihtHDSqOvXyyGDDkgU465ty9UtBtTuo0ZYGrdawQYbUsnIjwLuZO2EFV7SzbsC54DOwKiQbGqe1ldMR6C/WQRJrEYvUyGlmerpVyG7DAOvaUW2BqjOd+s+tYHtQJ+EtJJ8SiYnmB1+aBtSV55vh407hYB2jLg5QwFZWN1A45M1GHlqHQrihuapHpYC3yOCXOqps84B3gesgzYle/D2X4AXOtc33p2I7gGr7ETkFGlX4Ldg3SldFSuLHEmaz0HCF2BcnBzjDWCa5XIz4ACgTivzdigwsa01sDFAe2BglsBXWzroDcBzYJ7Z3taBnHfY69gTWWd1kRlwl9+yELIOUhilwSArbPWLVsDdkKrIB6mgMwPuTkQPLF16mmQqPZ7YOVY5HO62mQPXqw15ly7APvP39U2tWpr7VP6HvVDmwNMWdg48LXNp5+WMp2Uu7byc8bTMpZknG6LDuD6ZNaBCgathDbEDjF5EHbY/BtSg/nKe5TBZhYL3is+Be9FUxKCc8SKS6bVUxTL+B0vIxDFgJjJqAAAAAElFTkSuQmCC" width="23" height="24" alt="N_(u_1)" /></span><span> and </span><span texencoding="N_{u_2}" style="vertical-align:-10px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC4AAAAwCAYAAABuZUjcAAAECUlEQVRoQ+2YaahOWxjHfycyZPyAzFIkZBZJlw/IB0K43WsmRPeKzMNNMkUyJHOmO+Qi1yUKGT4QMuQDys1VpEjmJFOZ+utZp23be5/9Ou9+z6Z31/lw3v2stf7r2f/n//zXKuAbfQq+Udzkgef6y+Uzns94zAx8l1RpBAy2vyaWiN+BCcCLgMRUBX4G+gE97f1tYDuwFngcM5mxwuJkvCvwB9AAuAEMBK5EzN4Q2AlUto1ExcYCGRQUB3h14G+gu00wFVgFfAhZVV9qF3AGmAG8+Wp0EQPjAG8HHARq2TzHgeHAvZB5OwOHgZHAv0mA1pxxgI8DhgA3gREGZEAEqMkW9xNwvaSAlzdavAT2Abst82FFWglYZ2B/BZ6XFHAVpPi9Hthv6iAKiCZSjws+YC7+H9twUriLpEoPy6BTkv7AXkOzEJgPvPOgU7wUKGhTWd1EFMf17jegFTAGeGY0+dMU5jwwCLhliFy8inMY8CirSH2TRQGvAmwx7Z5rmVW8im9FQJEGxSeGPQp4S0BcnQYc8CBwDaYj4C3SsPhEwEcBlwROB/yyVgqYB+greIu0D7AgID6nwMsAS4FqQJCsdTCVUVNSkS62zej/MC+T1Q2EZbw2sAM4YaD87b2CRxpVpBNNYSSZm7KKMGSyMOCubatDHgsZ65VGNabW1mEvlSRwKYe0W7ZW1jToES2cNOr9kVzIoAMSlHHXtuXqJgFq90GPXxqXWMF6G1JiyQ8C7mTtLyu8qMWbA3uApkBfn2xqnOZXTGOgk1kESayetqZCopnq6X0mu/QDL21FNgcoyndrnbLAMqB9BK0kn5LJH80On7MNqSv/YoeNU5mAdhlxY7oBsrBaQM8TazDy1DoUhD0ap3qYArwKCHLUU2cdCzzwWAdtSvbgbnGAZzo2brw7EZ0GZtqJyCnSas9vmq+FSesPQDlAhxbFXPUvFucgERdgWJwc41FgqHG5BrAZUKeVedtqAyXBOhLqvPq/SatMnPrEKOA/7wK5AD7b6KAbgGvAeLO99T2cV0OTcRPokwZQ9TbLBEL2Qt25sBEmDdzxWxZC1kEKI9XqYoWtflEPuG+bWQ689WTWnXdl8hRbWENJA3cnorNGlzYmmaLHRTvHqvAvA8rwax/fdJ8juTzk7xFJA9fVhrxLM2CD+fuKplZ1zH2K/2FXHS7jMm6f3RgkDby4hT3aitjJaOF8aQZeE1hjLtQVbOqBi+9qaHdMab6gUhozLkzS77rASp/KpDrjumSVYZN2B90KfwKftozLQepOZpHvFkx87w1scy4yTcBljWUF5B4feuRIRkzeRc1JR8lUZVx83gj0CtFP3VtKGp+mDXjGep8mqmQEPg88o3RlITif8SwkMaMpPgKxVNIxCGGk4AAAAABJRU5ErkJggg==" width="23" height="24" alt="N_(u_2)" /></span><span> elements respectively, DynaProg will use the external model function passing as inputs:</span></div><ul  class = 'S5'><li  class = 'S6'><span style=' font-family: monospace;'>u{1}</span><span> as an array of size </span><span texencoding="1 \times 1 \times N_{u_1} \times 1 " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span>,</span></li><li  class = 'S6'><span style=' font-family: monospace;'>u{1}</span><span> as an array of size </span><span texencoding="1 \times 1 \times 1 \times N_{u_2}" style="vertical-align:-10px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAL0AAAAwCAYAAABE+Xs2AAAH10lEQVR4Xu2cdcg1RRSHn0/FRMVG/cNWxEIFxUCxxe7u7sRCDGwMLCwM7MYWG1EQCxQVFREUwcDAROzgB2dk3Pfu7ux7Z99ldmdBvs/7zb0785tnz5xz5sxOI19ZgYEpMG1g483DzQqQoc8QDE6BDP3gpjwPOEOfGRicAhn6wU15HnCGPjMwOAUy9IOb8jzgUOinA9YEDgLOBT5ITLp5gP2AGa3/KXU/Ne1nAjYHdgF2NKF/ArYFnisRfi1gO2AfYG5r8xhwBfBM7Mmqg94Jfpx1+i1g54SgF+wS8khgEeB04OzYIrb0e6lrPxtwIXCY6XM+cBrwV4leYvFY4BLgPOAM4M82tK2CfjlgD+AzYEtgYyAV6GVt9gYWAGYwMWdPCPqUtfc53Qu4xT54FdgV+LgC5FPMQG0DvNYG8PrNKujlCvxuN3adTwX66a3fsirzAXcCGyYEfcraO1Y1hgvM4LjPDgBuLIF5FuBSYH5gf+C7LqD377k7cPuYll6W9hDgXuCTBgOStdZDJ7G+bfA911Quzh3AJmNAL+OwLrAwcE+DZVffky/7M/A08M8k+p+q9guZ7u8B6wHLAg9WAC33U8bpCYu7JqNVkLx1Pr37kXGFl+XV0iV/+nHg8EDwBfx1wNbmD8ovLPMJywYcA/plDPbFzXJpya7zN6WtlvNrgY/GiIVS1V7BqYyN+r8TcBRQFdBuZIZBbnT04NWHY6qg1z0VlWu5OzAQfFnVqwz464GTO7b0mwLX2DgUcFWBryB0N+Bq6/OhwJMdWvoutJdGAnhPYCWz8lrtlZE5EfitYKXUfgfTrYknEGTdu4K+CfixgNc9Y1h6F/+EgB8TeN13XEvv5jsU/BjaC24ZrE9thZ7D3FO5eu9bKvNdD0TXXn78qAeiMdhVX5hKSx8qfgzR/THHgj4E/NjAx4Q+xOjE0t65g0oRP2KToeD0Bvv78Ra0Or/dtb/IXKKokBd/rAvoq8T3Rb8NkDhfj6lATOirwP+74NJob0OB27gBWSxLX2d0Ymq/FXCxuStv240XA+4CVh8R0I5qP+a0l3+9K+hHga8g9QTz4WMBH9O9KbqFvqujh1MB9mXmw8cCPralLwM/pvZKWihhsRSgFOUPdlN/88kPaMva9xL6IvhukDGBbwv6osVXuk2XArCYwLcFfZvazwtoDl8akXrUptt9lr50Ae3M5vZoD0glLuOujLUPS5eW3nVO+VultlYGFNwozfdObc/DG8R2b/w7y0opq3SOfXiW/f2P8O7Vtozt3vg3bEP7VYFHbUe8mHrUTrlKE5S+dAGtNLzbdmLLanNqRWrSoGvofT/S9btJHj9krG1B7wetyj7o0rJdl84M6bPfpi3o29L+YEAp2rIarQ289KXcwq9sw0rj/LypOJNp3yX0xcBJRUZyDULz+KHjbQP6YpZGk/erpemUGowJfhvQt6W9KyWY1TYgZQSK11xe+lL1OEpTyuprxXRlL6FzO6l2XUFflikIzSU3GWxs6IvAOx9efQrJ4zfpu9rGhr5N7V0pwf2Wkiwbq5++VBsVNsrFnZKrC+jrUmOxwY8JfRnwLviSnrHBjwl929q7UgLVKb1YQbCfvvywkNpsHfypht6vpanK0sQEPxb0fi2NCt/KsjSxwY8Ffdvau9TjZgF1RmqrennV12tV8FObDvo5LbmxArAooLTqN4CCYblCS9ifjeOAEOhVj65UkraHvwAmW+scKrobdCzwlRVSZaTyxmV1H3XWJRR49zuxwE9J+xUtC/NjQN28dFoNeAjQLqxKikdd7jdVoXqS1eu43dtXLHb6pW7yiv9eBb3yrdsDW9h/7ruv29P5shX6FwuHRvVBbsExdiqmSR7eB19VmjpVE5IOlCVZw46tKQXq8ugKrPQAPG955NDCJlkVlVYv2CAP74OvlUEWWwFbyJWS9lpJlbFR+beA1PWUAa1U5PclA9bJKhmhm2wuRjVz7pLv87t4QEdXVdbQOK8fYulDJimkjSJ7AaiU5JchX7A2Al/nJ7WFrbr0rq5VrJ5eZzdDhZa+StHJGmmzpqsrVe1l6Pa1B0qW3WV+lvc+k6Yan07KqUpTK8gbtuqoEnbCSjCV0Hc14fm+aSrgKi/l2yuNrXy+i2+eNejlbgt4bXi52G1pW3m06sj3l3fwv7MPGfo0gRhCr5c0ay1XSUGvYjJBvLbt+DofXyupSpb1/84T0E6zPANdEzbJMvRDwCfNMTp/Xq6tAlm90UJBsur05eOrVEUbW3rNiCy/q+bUaP3zuXpI/udaZujTBGIIvdau9hHm08uaqy5/HStxUBWn3BkdJRXD2g1Xabd/KR2qU1vy8/0HIr+qewj0JDpGvSzqcuAFO2b6pvnx8t+VgTuz4vios/TK7094s0K29IkSkbtdqYBSy7cCN48qb8jQZ3r6poCYVpZH+zTaUJ2Q5s7Q923K83iUuVHV66ll+0EZ+gxJnxRQqYtKZpSbL939ztD3acqHPRaVNSir87AFv6VqZOiHDUpfRi/g9VIBlTOrrsov9VaeX68W/M/yZ+j7Mu3DHYcqUeXDr18AXoroZbAqYzjaD2gz9MOFpQ8jVzWtdmevBNw55eK4VCn8gP9hhr4PU5/H0EiBDH0juXLjPiiQoe/DLOYxNFIgQ99Irty4Dwpk6Pswi3kMjRTI0DeSKzfugwL/AjZxjE8EUJzKAAAAAElFTkSuQmCC" width="94.5" height="24" alt="1 x 1 x 1 x N_(u_2)" /></span><span>.</span></li></ul><div  class = 'S1'><span>And it will expect the outputs, </span><span style=' font-family: monospace;'>intVar</span><span> and </span><span style=' font-family: monospace;'>unFeas, </span><span>to be arrays of size </span><span texencoding="1 \times 1 \times N_{u_1} \times N_{u_2}" style="vertical-align:-10px"><img src="data:image/png;base64,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" width="107" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span>,  </span><span texencoding="1 \times 1 \times N_{u_1} \times 1 " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span> or </span><span texencoding="1 \times 1 \times 1 \times N_{u_2}" style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x 1 x N_(u_2)" /></span><span>.</span></div><h3  class = 'S7'><span>Array indexing</span></h3><div  class = 'S1'><span>The first issue lies in line 23 of the external function.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Gearbox</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>gbSpRatio = gb.spdRatio(u{1});</span></span></div></div></div><div  class = 'S4'><span>The issue here is that DynaProg will index into </span><span style=' font-family: monospace;'>gb.spdRatio</span><span> with </span><span style=' font-family: monospace;'>u{1}</span><span> which is a </span><span texencoding="1 \times 1 \times N_{u_1} \times 1 " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span> array, but the result (</span><span style=' font-family: monospace;'>gbSpRatio</span><span>) will be a </span><span texencoding=" N_{u_1} \times 1 \times 1 \times 1" style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span>array. This is unintended and DynaProg will interpret this as meaning that the gearbox speed ratio is a function of the first state variable only, rather than being a function of the first control variable only and this in turn will produce an error.</span></div><div  class = 'S1'><span>To fix this, we must make sure that </span><span style=' font-family: monospace;'>gbSpRatio</span><span> is evaluated as a </span><span texencoding="1 \times 1 \times N_{u_1} \times 1 " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span> array. One way to do this is to explicitly initialize it as having to have the same size as </span><span style=' font-family: monospace;'>u{1}</span><span>, and then using </span><span style=' font-family: monospace;'>(:) </span><span>in the left-hand size when assigning values to it to ensure we preserve its shape.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Gearbox</span></span></div></div><div class="inlineWrapper"><div  class = 'S10'><span style="white-space: pre;"><span>gbSpRatio = zeros(size(u{1}));</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>gbSpRatio(:) = gb.spdRatio(u{1});</span></span></div></div></div><div  class = 'S4'><span>You can read more about the way MATLAB handles indexing </span><a href = "https://blogs.mathworks.com/loren/2006/08/09/essence-of-indexing/?s_tid=srchtitle"><span>in this blog post</span></a><span>.</span></div><div  class = 'S1'><span>From a physical point of view, this line evaluates the speed ratio of the gear engaged by the vehicle's gearbox as a function of the gear number, that is the control variable </span><span texencoding="u_1" style="vertical-align:-6px"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB8AAAAoCAYAAAAG0SEsAAACAElEQVRYR+3YTahNYRQG4OemRPJXDIwuSqIwUCjqlmJAiEj+RhRFSRQ3pAgjIRHlZyCJDDASEwPMDMhESkmRmEjyU6JV69budE7uvvt0T7f2V6fT/vp63/W+6/1Wu92lg6urg9xq8o64X9te2z6oDtSBG1S7+8iGrO3DMTpVfMPvsvY1Ux6gMzEFc7EAV3CzAXwrLuMxNuFDu8jHYz/24CNW4HkBfGwSr8UF7MXPdpD3YfTiBB5gC74UwOfhLiZhBy6VJY7zrQIXvTyfpCdxGH+SYBiO5F4zV/pdRyvy6biFOViF+wXEyEL0f34LVyqTL8FDvMB6vE7EKDZycCqfT+NAk6THudmZm3DwabOKmimPvYM4huvYibhKsWak6nAk1mbcaACejF1YjalYVIa8mOTo9XH8xagsKLhC/RtE2l82kI/ALxzC0bLkYdcdTMNSPMpgbsMYTEir40zsfW3R5Ci8NPlK3MMzbMQ79GTwzuS9Xp5pD1fW4BOeNBRRmjz6HdcofjG9dmfiw8J9af9tzMpi3mJDzoPvVclHIhK8PZMe6qMNMUheYWFB4VmMy0SH8sZVWnkArMPFRIr/sPpzPk/EOSzLXIRD79vZ834Pif8cHJDymryqAx2zvXhlS43Xqoq7sbgwI67iWr6M/CiCD9kXyKoO1V8mKjs4IICOBu4feedvKfC98XEAAAAASUVORK5CYII=" width="15.5" height="20" alt="u_1" /></span><span>; </span><span style=' font-family: monospace;'>gb.spdRatio</span><span> is the vector of speed ratios, with each element being the speed ratio associated to a certain gear number. This vector of speed ratios is created in the </span><span style=' font-family: monospace;'>hev_data</span><span> function and then passed to the model function as an </span><a href = "./use_additional_inputs.html"><span>additional input</span></a><span>.</span></div><h3  class = 'S7'><span>Querying interpolants</span></h3><div  class = 'S1'><span>At line 30 of the external function, we use a </span><span style=' font-family: monospace;'>griddedInterpolant</span><span> object to evaluate </span><span style=' font-family: monospace;'>gbEff </span><span>as a function of two previously computed variables, </span><span style=' font-family: monospace;'>fdSpd</span><span> and </span><span style=' font-family: monospace;'>fdTrq</span><span>, and the control variable </span><span style=' font-family: monospace;'>u{1}</span><span>. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Gearbox efficiency (-)</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>gbEff = gb.effMap(fdSpd, fdTrq, u{1});</span></span></div></div></div><div  class = 'S4'><span>Since, based on previous operations, </span><span style=' font-family: monospace;'>fdSpd</span><span> and </span><span style=' font-family: monospace;'>fdTrq</span><span> are not dependant on any state or control variable, they are scalars, while  </span><span style=' font-family: monospace;'>u{1}</span><span> is a </span><span texencoding="1 \times 1 \times N_{u_1} \times 1 " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="94.5" height="24" alt="1 x 1 x N_(u_1) x 1" /></span><span> array. The </span><span style=' font-family: monospace;'>griddedInterpolant</span><span> object requires that all query variables (inputs) have the same size and it will therefore throw an error.</span></div><div  class = 'S1'><span>To fix this, we expand </span><span style=' font-family: monospace;'>fdSpd</span><span> and </span><span style=' font-family: monospace;'>fdTrq</span><span> to have the same size as </span><span style=' font-family: monospace;'>u{1}.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span style="color: rgb(2, 128, 9);">% Gearbox efficiency (-)</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>gbEff = gb.effMap(fdSpd.*ones(size(u{1})), fdTrq.*ones(size(u{1})), u{1});</span></span></div></div></div><div  class = 'S4'><span>From a physical point of view, this line evaluates the gearbox transmission efficiency as a function of its output shaft speed and torque and the engaged gear. This efficiency is evaluated by interpolating an efficiency map which is created in the </span><span style=' font-family: monospace;'>hev_data</span><span> function and then passed to the model function as an </span><a href = "./use_additional_inputs.html"><span>additional input</span></a><span>.</span></div><div  class = 'S1'><span>Similar issues arise at lines 82 and 78 of the external function.</span></div><h3  class = 'S7'><span>Logical indexing</span></h3><div  class = 'S1'><span>Open the naive version of the internal model by entering</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>open(</span><span style="color: rgb(170, 4, 249);">'hev_int_naive.m'</span><span>)</span></span></div></div></div><div  class = 'S4'><span>At line 60 of the internal model, we use logical indexing.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>RR_HC = (intVar{4} - hcTailpipeFlwRate) ./ egFlwRate .* 29 / 44.1;</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>RR_HC(egFlwRate==0) = 0;</span></span></div></div></div><div  class = 'S4'><span>At lines 57 and 60 of the internal model, we evaluate the molar fractions of the converted polltants in the exhaust gas flow rate. Since the mass flow rate of exhaust gases </span><span style=' font-family: monospace;'>egFlwRate</span><span> might be zero, the result of the first line may result in </span><span style=' font-family: monospace;'>nan</span><span> since we might divide by zero. To avoid this, we add a second line where we set the molar fractions to zero when </span><span style=' font-family: monospace;'>egFlwRate</span><span> is zero by logical indexing. </span></div><div  class = 'S1'><span>Based on previous operations, the size of </span><span style=' font-family: monospace;'>egFlwRate</span><span> is </span><span texencoding="1 \times 1 \times N_{u_1} \times N_{u_2} " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="107" height="24" alt="1 x 1 x N_(u_1) x N_(u_2)" /></span><span> since it is a function of the control variables only, while the size of </span><span style=' font-family: monospace;'>RR_HC</span><span> is </span><span texencoding="1 \times N_{x_2} \times N_{u_1} \times N_{u_2} " style="vertical-align:-10px"><img src="data:image/png;base64,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" width="119" height="24" alt="1 x N_(x_2) x N_(u_1) x N_(u_2)" /></span><span> since it is also a function of the second state variable (the TWC temperature). Therefore, logical indexing will not work as intended here and it will yeld unintended results.</span></div><div  class = 'S1'><span>To fix this, we expand </span><span style=' font-family: monospace;'>egFlwRate</span><span>  to have the same size as </span><span style=' font-family: monospace;'>RR_HC</span><span> before using logical indexing.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S8'><span style="white-space: pre;"><span>egFlwRate = egFlwRate + zeros(size(RR_HC));</span></span></div></div><div class="inlineWrapper"><div  class = 'S9'><span style="white-space: pre;"><span>RR_HC(egFlwRate==0) = 0;</span></span></div></div></div><h2  class = 'S11'><span>Using Safe Mode</span></h2><div  class = 'S1'><span>Troubleshooting the system and costs function allows to solve various typical issues that can interfere with DynaProg's algorithm. This procedure is strongly recommended if you have a complex optimization problems with many state and control variables.</span></div><div  class = 'S1'><span>If, however, your optimization problem is relatively simple or computational time is not critical to your task, you can enable Safe Mode. Safe Mode attempts to automatically handle all these issues at the cost of increased optimization time.</span></div><div  class = 'S1'><span>To see an example, type</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S3'><span style="white-space: pre;"><span>open(</span><span style="color: rgb(170, 4, 249);">'hev_int_naive.m'</span><span>)</span></span></div></div></div><div  class = 'S4'><span>in the Command Window. </span></div><div  class = 'S1'></div></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Troubleshooting the HEV with a Three-Way Catalyst example
% Consider the <matlab:open('./example_split_hev.mlx') HEV with a Three-Way 
% Catalyst>. The system and cost functions that are used there are designed with 
% some extra-care so as to avoid all the common issues that may arise with DynaProg. 
% These issues are tipically related to the way in which MATLAB handles n-dimensional 
% arrays; for more information, see <matlab:open('./troubleshooting.mlx') Troubleshooting 
% your model and Safe Mode>.
% 
% We will start from a naively designed model function, analyze some issues 
% that prevent their usage without using Safe Mode and discuss some solutions.
%% Troubleshooting the system and cost functions
% Open the naive version of the external model by entering

open('hev_ext_naive.m')
%% 
% in the Command Window.
% 
% Since this optimization problem involves two stae variables and two control 
% variable, which are discretized on computational grids having $N_{x_1}$, $N_{x_2}$, 
% $N_{u_1}$ and $N_{u_2}$ elements respectively, DynaProg will use the external 
% model function passing as inputs:
%% 
% * |u{1}| as an array of size $1 \times 1 \times N_{u_1} \times 1 $,
% * |u{1}| as an array of size $1 \times 1 \times 1 \times N_{u_2}$.
%% 
% And it will expect the outputs, |intVar| and |unFeas,| to be arrays of size 
% $1 \times 1 \times N_{u_1} \times N_{u_2}$,  $1 \times 1 \times N_{u_1} \times 
% 1 $ or $1 \times 1 \times 1 \times N_{u_2}$.
% Array indexing
% The first issue lies in line 23 of the external function.

% Gearbox
gbSpRatio = gb.spdRatio(u{1});
%% 
% The issue here is that DynaProg will index into |gb.spdRatio| with |u{1}| 
% which is a $1 \times 1 \times N_{u_1} \times 1 $ array, but the result (|gbSpRatio|) 
% will be a $ N_{u_1} \times 1 \times 1 \times 1$array. This is unintended and 
% DynaProg will interpret this as meaning that the gearbox speed ratio is a function 
% of the first state variable only, rather than being a function of the first 
% control variable only and this in turn will produce an error.
% 
% To fix this, we must make sure that |gbSpRatio| is evaluated as a $1 \times 
% 1 \times N_{u_1} \times 1 $ array. One way to do this is to explicitly initialize 
% it as having to have the same size as |u{1}|, and then using |(:)| in the left-hand 
% size when assigning values to it to ensure we preserve its shape.

% Gearbox
gbSpRatio = zeros(size(u{1}));
gbSpRatio(:) = gb.spdRatio(u{1});
%% 
% You can read more about the way MATLAB handles indexing <https://blogs.mathworks.com/loren/2006/08/09/essence-of-indexing/?s_tid=srchtitle 
% in this blog post>.
% 
% From a physical point of view, this line evaluates the speed ratio of the 
% gear engaged by the vehicle's gearbox as a function of the gear number, that 
% is the control variable $u_1$; |gb.spdRatio| is the vector of speed ratios, 
% with each element being the speed ratio associated to a certain gear number. 
% This vector of speed ratios is created in the |hev_data| function and then passed 
% to the model function as an <matlab:open('./use_additional_inputs.mlx') additional 
% input>.
% Querying interpolants
% At line 30 of the external function, we use a |griddedInterpolant| object 
% to evaluate |gbEff| as a function of two previously computed variables, |fdSpd| 
% and |fdTrq|, and the control variable |u{1}|. 

% Gearbox efficiency (-)
gbEff = gb.effMap(fdSpd, fdTrq, u{1});
%% 
% Since, based on previous operations, |fdSpd| and |fdTrq| are not dependant 
% on any state or control variable, they are scalars, while  |u{1}| is a $1 \times 
% 1 \times N_{u_1} \times 1 $ array. The |griddedInterpolant| object requires 
% that all query variables (inputs) have the same size and it will therefore throw 
% an error.
% 
% To fix this, we expand |fdSpd| and |fdTrq| to have the same size as |u{1}.|

% Gearbox efficiency (-)
gbEff = gb.effMap(fdSpd.*ones(size(u{1})), fdTrq.*ones(size(u{1})), u{1});
%% 
% From a physical point of view, this line evaluates the gearbox transmission 
% efficiency as a function of its output shaft speed and torque and the engaged 
% gear. This efficiency is evaluated by interpolating an efficiency map which 
% is created in the |hev_data| function and then passed to the model function 
% as an <matlab:open('./use_additional_inputs.mlx') additional input>.
% 
% Similar issues arise at lines 82 and 78 of the external function.
% Logical indexing
% Open the naive version of the internal model by entering

open('hev_int_naive.m')
%% 
% At line 60 of the internal model, we use logical indexing.

RR_HC = (intVar{4} - hcTailpipeFlwRate) ./ egFlwRate .* 29 / 44.1;
RR_HC(egFlwRate==0) = 0;
%% 
% At lines 57 and 60 of the internal model, we evaluate the molar fractions 
% of the converted polltants in the exhaust gas flow rate. Since the mass flow 
% rate of exhaust gases |egFlwRate| might be zero, the result of the first line 
% may result in |nan| since we might divide by zero. To avoid this, we add a second 
% line where we set the molar fractions to zero when |egFlwRate| is zero by logical 
% indexing. 
% 
% Based on previous operations, the size of |egFlwRate| is $1 \times 1 \times 
% N_{u_1} \times N_{u_2} $ since it is a function of the control variables only, 
% while the size of |RR_HC| is $1 \times N_{x_2} \times N_{u_1} \times N_{u_2} 
% $ since it is also a function of the second state variable (the TWC temperature). 
% Therefore, logical indexing will not work as intended here and it will yeld 
% unintended results.
% 
% To fix this, we expand |egFlwRate|  to have the same size as |RR_HC| before 
% using logical indexing.

egFlwRate = egFlwRate + zeros(size(RR_HC));
RR_HC(egFlwRate==0) = 0;
%% Using Safe Mode
% Troubleshooting the system and costs function allows to solve various typical 
% issues that can interfere with DynaProg's algorithm. This procedure is strongly 
% recommended if you have a complex optimization problems with many state and 
% control variables.
% 
% If, however, your optimization problem is relatively simple or computational 
% time is not critical to your task, you can enable Safe Mode. Safe Mode attempts 
% to automatically handle all these issues at the cost of increased optimization 
% time.
% 
% To see an example, type

open('hev_int_naive.m')
%% 
% in the Command Window. 
% 
%
##### SOURCE END #####
--></body></html>